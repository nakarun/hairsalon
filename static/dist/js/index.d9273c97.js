(function(t){function e(e){for(var a,r,i=e[0],c=e[1],l=e[2],d=0,f=[];d<i.length;d++)r=i[d],Object.prototype.hasOwnProperty.call(n,r)&&n[r]&&f.push(n[r][0]),n[r]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);u&&u(e);while(f.length)f.shift()();return o.push.apply(o,l||[]),s()}function s(){for(var t,e=0;e<o.length;e++){for(var s=o[e],a=!0,i=1;i<s.length;i++){var c=s[i];0!==n[c]&&(a=!1)}a&&(o.splice(e--,1),t=r(r.s=s[0]))}return t}var a={},n={index:0},o=[];function r(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=t,r.c=a,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(s,a,function(e){return t[e]}.bind(null,a));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/static/dist/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=e,i=i.slice();for(var l=0;l<i.length;l++)e(i[l]);var u=c;o.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"034f":function(t,e,s){"use strict";s("85ec")},"2a67":function(t,e,s){},"41d4":function(t,e,s){"use strict";s("fefe")},"4af0":function(t,e,s){},"4dd4":function(t,e,s){},"509b":function(t,e,s){"use strict";s("79cd")},"56d7":function(t,e,s){"use strict";s.r(e);s("e260"),s("e6cf"),s("cca6"),s("a79d");var a=s("2b0e"),n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-app",{attrs:{id:"app"}},[s("router-view")],1)},o=[],r=(s("034f"),s("2877")),i={},c=Object(r["a"])(i,n,o,!1,null,null,null),l=c.exports,u=(s("ac1f"),s("5319"),s("8c4f")),d=(s("b0c0"),s("2f62")),f=(s("d3b7"),s("99af"),s("07ac"),s("bc3a")),m=s.n(f),p=m.a.create({baseURL:"/api/v1/",timeout:5e3,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});p.interceptors.request.use((function(t){y.dispatch("message/clearMessages");var e=localStorage.getItem("access");return e?(t.headers.Authorization="JWT "+e,t):t}),(function(t){return Promise.reject(t)})),p.interceptors.response.use((function(t){return t}),(function(t){console.log("error.response=",t.response);var e,s=t.response?t.response.status:500;if(400===s){var a=[].concat.apply([],Object.values(t.response.data));y.dispatch("message/setWarningMessages",{messages:a})}else if(401===s){var n=localStorage.getItem("access");e=null!=n?"ログイン有効期限切れ":"認証エラー",y.dispatch("auth/logout"),y.dispatch("message/setErrorMessage",{message:e})}else 403===s?(e="権限エラーです。",y.dispatch("message/setErrorMessage",{message:e})):(e="想定外のエラーです。",y.dispatch("message/setErrorMessage",{message:e}));return Promise.reject(t)}));var v=p;a["default"].use(d["a"]);var h={namespaced:!0,state:{useruuid:"",username:"",isLoggedIn:!1},mutations:{set:function(t,e){t.useruuid=e.user.uuid,t.username=e.user.username,t.isLoggedIn=!0},clear:function(t){t.useruuid="",t.username="",t.isLoggedIn=!1}},actions:{login:function(t,e){return v.post("/auth/jwt/create/",{username:e.username,password:e.password}).then((function(e){return localStorage.setItem("access",e.data.access),t.dispatch("renew")}))},logout:function(t){localStorage.removeItem("access"),t.commit("clear")},renew:function(t){return v.get("/auth/users/me/").then((function(e){var s=e.data;t.commit("set",{user:s})}))}}},g={namespaced:!0,state:{error:"",warnings:[],info:""},mutations:{set:function(t,e){e.error&&(t.error=e.error),e.warnings&&(t.warnings=e.warnings),e.info&&(t.info=e.info)},clear:function(t){t.error="",t.warnings=[],t.info=""}},actions:{setErrorMessage:function(t,e){t.commit("clear"),t.commit("set",{error:e.message})},setWarningMessages:function(t,e){t.commit("clear"),t.commit("set",{warnings:e.messages})},setInfoMessage:function(t,e){t.commit("clear"),t.commit("set",{info:e.message})},clearMessages:function(t){t.commit("clear")}}},b={namespaced:!0,state:{salon:""},mutations:{set:function(t,e){t.salon=e.staff.salon},clear:function(t){t.salon=""}},actions:{getStaffData:function(t,e){return v.get("/staff/".concat(e.useruuid,"/")).then((function(e){var s=e.data;t.commit("set",{staff:s})})).catch((function(t){console.log(t)}))}}},_={namespaced:!0,state:{uuid:"",salonname:""},mutations:{set:function(t,e){t.uuid=e.salon.uuid,t.salonname=e.salon.name},clear:function(t){t.uuid="",t.salonname=""}},actions:{getSalonData:function(t,e){return v.get("/salon/".concat(e.salon,"/")).then((function(e){var s=e.data;t.commit("set",{salon:s})})).catch((function(t){console.log(t)}))}}},w={namespaced:!0,state:{pointcards:[]},mutations:{set:function(t,e){t.pointcards=e.pointcards},clear:function(t){t.pointcards=[]}},actions:{getPointcards:function(t,e){return v.get("/pointcard/",{params:{salon:e.salon}}).then((function(e){var s=e.data;t.commit("set",{pointcards:s})}))}}},x=new d["a"].Store({modules:{auth:h,message:g,staff:b,salon:_,pointcards:w}}),y=x,k=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"login-page"}},[s("GlobalHeader"),s("GlobalMessage"),s("main",{staticClass:"container mt-5 p-5"},[s("p",{staticClass:"h5 mb-5"},[t._v("Login")]),s("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[s("v-text-field",{attrs:{counter:10,rules:t.usernameRules,label:"Name",required:""},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),s("v-text-field",{attrs:{rules:t.passwordRules,label:"Password",type:"password",required:""},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),s("v-btn",{staticClass:"mt-4",attrs:{disabled:!t.valid,color:"primary",block:""},on:{click:t.validate}},[t._v(" Login ")])],1)],1)],1)},$=[],C=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"header"}},[s("v-app-bar",{attrs:{color:"primary",prominent:"",dark:""}},[s("v-app-bar-nav-icon",{attrs:{dark:""}}),s("v-toolbar-title",[t._v("Salon Admin")]),s("v-spacer"),s("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on;return[s("v-btn",t._g({attrs:{icon:""}},a),[s("v-icon",[t._v("mdi-account")])],1)]}}])},[s("v-list",[s("v-list-item",[s("v-list-item-title",[t._v(" "+t._s(t.username)+" ")])],1),s("v-list-item",[s("v-list-item-title",{on:{click:t.clickLogout}},[t._v(" ログアウト ")])],1)],1)],1)],1)],1)},P=[],j={computed:{username:function(){return this.$store.state.auth.username},isLoggedIn:function(){return this.$store.state.auth.isLoggedIn}},methods:{clickLogout:function(){this.$store.dispatch("auth/logout"),this.$store.dispatch("message/setInfoMessage",{message:"ログアウトしました。"}),this.$router.replace("/login")},clickLogin:function(){this.$store.dispatch("message/clearMessages"),this.$router.replace("/login")}}},M=j,S=Object(r["a"])(M,C,P,!1,null,null,null),I=S.exports,O=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"messages"}},[s("b-alert",{directives:[{name:"show",rawName:"v-show",value:t.message.error,expression:"message.error"}],staticClass:"mb-0",attrs:{variant:"danger",show:""}},[t._v(" "+t._s(t.message.error)+" ")]),s("b-alert",{directives:[{name:"show",rawName:"v-show",value:t.message.warnings.length>0,expression:"message.warnings.length > 0"}],staticClass:"mb-0",attrs:{variant:"warning",show:""}},t._l(t.message.warnings,(function(e){return s("p",{key:e,staticClass:"mb-0"},[t._v(" "+t._s(e)+" ")])})),0),s("b-alert",{directives:[{name:"show",rawName:"v-show",value:t.message.info,expression:"message.info"}],staticClass:"mb-0",attrs:{variant:"info",show:""}},[t._v(" "+t._s(t.message.info)+" ")])],1)},L=[],E={computed:{message:function(){return this.$store.state.message}}},D=E,q=Object(r["a"])(D,O,L,!1,null,null,null),Y=q.exports,R={components:{GlobalHeader:I,GlobalMessage:Y},data:function(){return{valid:!0,username:"",usernameRules:[function(t){return!!t||"ユーザー名を入力してください。"},function(t){return t&&t.length<=10||"ユーザー名は10文字以内です。"}],password:"",passwordRules:[function(t){return!!t||"パスワードを入力してください。"},function(t){return t&&t.length<=10||"パスワードは10文字以内です。"}]}},methods:{validate:function(){this.$refs.form.validate()&&this.submitLogin()},reset:function(){this.$refs.form.reset()},resetValidation:function(){this.$refs.form.resetValidation()},submitLogin:function(){var t=this;this.$store.dispatch("auth/login",{username:this.username,password:this.password}).then((function(){console.log("Login succeeded."),t.$store.dispatch("message/setInfoMessage",{message:"ログインしました。"});var e=t.$route.query.next||"/";t.$router.replace(e)}))}}},G=R,z=(s("b39d"),Object(r["a"])(G,k,$,!1,null,"66d13018",null)),H=z.exports,T=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"home"},[s("GlobalHeader"),s("GlobalMessage"),s("main",{staticClass:"container mt-5 p-5"},[s("Stamp"),s("Pointcards",{ref:"pointcards"}),s("CreatePointcard",{on:{created:t.fetchPointcards}}),s("Posts",{ref:"posts"}),s("Post",{on:{posted:t.fetchPosts}})],1)],1)},A=[],N=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"stamp"},[s("v-card",[s("v-card-title",[t._v("スタンプを発行する")]),s("v-form",{ref:"form",staticClass:"pa-3",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[s("v-select",{attrs:{items:t.pointcards,label:"ポイントカードを選択する","item-text":"uuid",attach:"","menu-props":{top:!1,offsetY:!0},"return-object":""},model:{value:t.selectedPointcard,callback:function(e){t.selectedPointcard=e},expression:"selectedPointcard"}}),s("v-select",{attrs:{items:t.customers,label:"利用者を選択する","item-text":"username",attach:"","menu-props":{top:!1,offsetY:!0},"return-object":""},model:{value:t.selectedCustomer,callback:function(e){t.selectedCustomer=e},expression:"selectedCustomer"}}),s("v-date-picker",{model:{value:t.picker,callback:function(e){t.picker=e},expression:"picker"}}),s("v-btn",{staticClass:"mt-4",attrs:{disabled:!t.valid,color:"primary",block:""},on:{click:t.validate}},[t._v(" スタンプを押す ")])],1)],1)],1)},W=[],J={name:"Stamp",data:function(){return{valid:!0,picker:new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString().substr(0,10),customers:[],selectedCustomer:{},selectedPointcard:{}}},computed:{pointcards:function(){return this.$store.state.pointcards.pointcards}},methods:{validate:function(){this.$refs.form.validate()&&this.submit()},reset:function(){this.$refs.form.reset()},submit:function(){var t=this;v.post("/stamp/",{customer:this.selectedCustomer.uuid,pointcard:this.selectedPointcard.uuid,stamped_at:this.picker}).then((function(e){console.log(e),t.reset()})).catch((function(t){console.log(t)}))},fetchCustomers:function(){var t=this;v.get("/customer/").then((function(e){t.customers=e.data})).catch((function(t){console.log(t)}))}},created:function(){this.fetchCustomers()}},U=J,F=(s("509b"),Object(r["a"])(U,N,W,!1,null,"541c7130",null)),V=F.exports,X=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"pointcards"},[s("v-card",{staticClass:"pb-1"},[s("v-card-title",[t._v("作成したポイントカード")]),t._l(t.pointcards,(function(e){return s("v-card",{key:e.uuid,staticClass:"ma-5 pa-3",attrs:{outlined:""}},[s("v-card-subtitle",{staticClass:"text-sm-left"},[t._v("Name: 〇〇 〇〇様")]),s("hr"),s("div",{staticClass:"frames"},[s("table",{staticClass:"table table-bordered"},t._l(e.vertical_cells_count,(function(a){return s("tr",{key:a,staticClass:"frame-line"},t._l(e.horizontal_cells_count,(function(t){return s("td",{key:t})})),0)})),0)]),s("hr"),s("v-card-text",{staticClass:"text-sm-caption text-sm-left"},[t._v("ご来店１回につき、１枠捺印致します。（お会計金額2,000円以上）")])],1)}))],2)],1)},B=[],K={name:"Pointcards",data:function(){return{}},computed:{pointcards:function(){return this.$store.state.pointcards.pointcards}},methods:{},created:function(){}},Q=K,Z=(s("da53"),Object(r["a"])(Q,X,B,!1,null,"16b7b42a",null)),tt=Z.exports,et=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"create-pointcard"},[s("v-card",[s("v-card-title",[t._v("ポイントカードを追加する")]),s("v-form",{ref:"form",staticClass:"pa-3",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[s("v-text-field",{attrs:{type:"number",label:"縦の枠数を入力してください。"},model:{value:t.v,callback:function(e){t.v=e},expression:"v"}}),s("v-text-field",{attrs:{type:"number",label:"横の枠数を入力してください。"},model:{value:t.h,callback:function(e){t.h=e},expression:"h"}}),s("v-btn",{staticClass:"mt-4",attrs:{disabled:!t.valid,color:"primary",block:""},on:{click:t.validate}},[t._v(" 作成する ")])],1)],1)],1)},st=[],at={name:"CreatePointcard",data:function(){return{valid:!0,v:0,h:0}},methods:{validate:function(){this.$refs.form.validate()&&this.createPointcard()},reset:function(){this.$refs.form.reset()},createPointcard:function(){var t=this,e=this.$store.state.salon.uuid;v.post("/pointcard/",{salon:e,vertical_cells_count:this.v,horizontal_cells_count:this.h}).then((function(e){console.log(e),t.$emit("created"),t.reset()})).catch((function(t){console.log(t)}))}}},nt=at,ot=(s("c8b0"),Object(r["a"])(nt,et,st,!1,null,"19bf863b",null)),rt=ot.exports,it=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"posts"},[s("v-card",[s("v-card-title",[t._v("お知らせ投稿一覧")]),s("v-data-table",{staticClass:"elevation-0",attrs:{headers:t.headers,items:t.formattedPosts},scopedSlots:t._u([{key:"item.edit",fn:function(e){var a=e.item;return[s("v-icon",{staticClass:"mr-2",attrs:{small:""},on:{click:function(e){return t.editItem(a)}}},[t._v(" mdi-pencil ")])]}},{key:"item.delete",fn:function(e){var a=e.item;return[s("v-icon",{attrs:{small:""},on:{click:function(e){return t.deleteItem(a)}}},[t._v(" mdi-delete ")])]}}])})],1)],1)},ct=[];s("159b");function lt(t,e){return t=new Date(t),e=e.replace(/YYYY/,t.getFullYear()),e=e.replace(/MM/,t.getMonth()+1),e=e.replace(/DD/,t.getDate()),e}var ut=lt,dt={name:"Posts",computed:{formattedPosts:function(){var t=[];return this.posts.forEach((function(e){t.push({id:e.id,title:e.title,published:ut(e.published,"YYYY年MM月DD日"),edit:"edit",delete:"delete"})})),t}},data:function(){return{headers:[{text:"投稿日時",align:"start",sortable:!1,value:"published"},{text:"投稿タイトル",value:"title"},{text:"編集",value:"edit"},{text:"削除",value:"delete"}],posts:[]}},methods:{fetchItems:function(){var t=this;this.posts=[],v.get("/news/").then((function(e){t.posts=e.data})).catch((function(t){console.log(t)}))},editItem:function(t){console.log(t)},deleteItem:function(t){var e=this;console.log(t),v.delete("/news/".concat(t.id,"/")).then((function(){e.fetchItems()})).catch((function(t){console.log(t)}))}},created:function(){this.fetchItems()}},ft=dt,mt=(s("a232"),Object(r["a"])(ft,it,ct,!1,null,"34ebf05d",null)),pt=mt.exports,vt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"post"},[s("v-card",[s("v-card-title",[t._v("お知らせを投稿する")]),s("v-form",{ref:"form",staticClass:"pa-3",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[s("v-text-field",{attrs:{counter:10,rules:t.titleRules,label:"タイトル",required:""},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),s("v-textarea",{attrs:{filled:"",required:""},model:{value:t.body,callback:function(e){t.body=e},expression:"body"}}),s("v-btn",{staticClass:"mt-4",attrs:{disabled:!t.valid,color:"primary",block:""},on:{click:t.validate}},[t._v(" 投稿する ")])],1)],1)],1)},ht=[],gt={name:"Post",data:function(){return{valid:!0,title:"",titleRules:[function(t){return!!t||"タイトルを入力してください。"},function(t){return t&&t.length<=10||"タイトルは10文字以内です。"}],body:"",bodyRules:[function(t){return!!t||"本文を入力してください。"},function(t){return t&&t.length<=100||"本文は100文字以内です。"}]}},methods:{validate:function(){this.$refs.form.validate()&&this.submit()},reset:function(){this.$refs.form.reset()},submit:function(){var t=this;v.post("/news/",{title:this.title,body:this.body,published:new Date}).then((function(e){console.log("posted. ".concat(e.data)),t.$emit("posted"),t.reset()})).catch((function(t){console.log(t)}))}}},bt=gt,_t=(s("41d4"),Object(r["a"])(bt,vt,ht,!1,null,"50b4436d",null)),wt=_t.exports,xt={name:"Home",components:{GlobalHeader:I,GlobalMessage:Y,Stamp:V,Pointcards:tt,CreatePointcard:rt,Posts:pt,Post:wt},methods:{fetchPointcards:function(){this.$store.dispatch("pointcards/getPointcards",{salon:this.$store.state.salon.uuid}).then((function(){console.log("get salon data ad pointcards.")}))},fetchPosts:function(){this.$refs.posts.fetchItems()}},created:function(){var t=this;this.$store.dispatch("staff/getStaffData",{useruuid:this.$store.state.auth.useruuid}).then((function(){t.$store.dispatch("salon/getSalonData",{salon:t.$store.state.staff.salon}).then((function(){t.fetchPointcards()}))}))}},yt=xt,kt=Object(r["a"])(yt,T,A,!1,null,null,null),$t=kt.exports;a["default"].use(u["a"]);var Ct=[{path:"/login",name:"LoginPage",component:H},{path:"/",name:"Home",component:$t,meta:{requiresAuth:!0}},{path:"/:catchAll(.*)",redirect:"/"}],Pt=new u["a"]({mode:"history",base:"/owner/",routes:Ct});function jt(t){console.log("Force to login page."),Pt.replace({path:"/login",query:{next:t.fullPath}})}Pt.beforeEach((function(t,e,s){var a=y.state.auth.isLoggedIn,n=localStorage.getItem("access");console.log("to.path=",t.path),console.log("isLoggedIn=",a),t.matched.some((function(t){return t.meta.requiresAuth}))?a?(console.log("User is already logged in. So, free to next."),s()):(console.log("User is not logged in."),null!=n?(console.log("Try to renew user info."),y.dispatch("auth/renew").then((function(){console.log("Succeeded to renew. So, free to next."),s()})).catch((function(){jt(t)}))):jt(t)):(console.log("Go to public page."),s())}));var Mt=Pt,St=s("ce5b"),It=s.n(St),Ot=(s("bf40"),s("dca6")),Lt=s.n(Ot);s("5363");a["default"].use(It.a);var Et={lang:{locales:{ja:Lt.a},current:"ja"},icons:{iconfont:"mdi"}},Dt=new It.a(Et),qt=s("5f5b");s("f9e3"),s("2dd8");a["default"].use(qt["a"]),a["default"].config.productionTip=!1,new a["default"]({bootstrap:void 0,vuetify:Dt,router:Mt,store:y,render:function(t){return t(l)}}).$mount("#app")},"603b":function(t,e,s){},"79cd":function(t,e,s){},"85ec":function(t,e,s){},a232:function(t,e,s){"use strict";s("603b")},b39d:function(t,e,s){"use strict";s("4dd4")},c8b0:function(t,e,s){"use strict";s("4af0")},da53:function(t,e,s){"use strict";s("2a67")},fefe:function(t,e,s){}});
//# sourceMappingURL=index.d9273c97.js.map