(function(e){function t(t){for(var a,r,i=t[0],c=t[1],l=t[2],d=0,f=[];d<i.length;d++)r=i[d],Object.prototype.hasOwnProperty.call(n,r)&&n[r]&&f.push(n[r][0]),n[r]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(f.length)f.shift()();return o.push.apply(o,l||[]),s()}function s(){for(var e,t=0;t<o.length;t++){for(var s=o[t],a=!0,i=1;i<s.length;i++){var c=s[i];0!==n[c]&&(a=!1)}a&&(o.splice(t--,1),e=r(r.s=s[0]))}return e}var a={},n={index:0},o=[];function r(t){if(a[t])return a[t].exports;var s=a[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=a,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(s,a,function(t){return e[t]}.bind(null,a));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/static/dist/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var u=c;o.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"034f":function(e,t,s){"use strict";s("85ec")},"2a67":function(e,t,s){},"41d4":function(e,t,s){"use strict";s("fefe")},"4af0":function(e,t,s){},"4dd4":function(e,t,s){},"509b":function(e,t,s){"use strict";s("79cd")},"56d7":function(e,t,s){"use strict";s.r(t);s("e260"),s("e6cf"),s("cca6"),s("a79d");var a=s("2b0e"),n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-app",{attrs:{id:"app"}},[s("router-view")],1)},o=[],r=(s("034f"),s("2877")),i={},c=Object(r["a"])(i,n,o,!1,null,null,null),l=c.exports,u=(s("ac1f"),s("5319"),s("8c4f")),d=s("53ca"),f=(s("b0c0"),s("2f62")),m=(s("d3b7"),s("99af"),s("07ac"),s("bc3a")),p=s.n(m),v=p.a.create({baseURL:"/api/v1/",timeout:5e3,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});v.interceptors.request.use((function(e){y.dispatch("message/clearMessages");var t=localStorage.getItem("access");return t?(e.headers.Authorization="JWT "+t,e):e}),(function(e){return Promise.reject(e)})),v.interceptors.response.use((function(e){return e}),(function(e){console.log("error.response=",e.response);var t,s=e.response?e.response.status:500;if(400===s){var a=[].concat.apply([],Object.values(e.response.data));y.dispatch("message/setWarningMessages",{messages:a})}else if(401===s){var n=localStorage.getItem("access");t=null!=n?"ログイン有効期限切れ":"認証エラー",y.dispatch("auth/logout"),y.dispatch("message/setErrorMessage",{message:t})}else 403===s?(t="権限エラーです。",y.dispatch("message/setErrorMessage",{message:t})):(t="想定外のエラーです。",y.dispatch("message/setErrorMessage",{message:t}));return Promise.reject(e)}));var h=v;a["default"].use(f["a"]);var g={namespaced:!0,state:{useruuid:"",username:"",isLoggedIn:!1},mutations:{set:function(e,t){e.useruuid=t.user.uuid,e.username=t.user.username,e.isLoggedIn=!0},clear:function(e){e.useruuid="",e.username="",e.isLoggedIn=!1}},actions:{login:function(e,t){return h.post("/auth/jwt/create/",{username:t.username,password:t.password}).then((function(t){return localStorage.setItem("access",t.data.access),e.dispatch("renew")}))},logout:function(e){localStorage.removeItem("access"),e.commit("clear")},renew:function(e){return h.get("/auth/users/me/").then((function(t){var s=t.data;e.commit("set",{user:s})}))}}},b={namespaced:!0,state:{error:"",warnings:[],info:""},mutations:{set:function(e,t){t.error&&(e.error=t.error),t.warnings&&(e.warnings=t.warnings),t.info&&(e.info=t.info)},clear:function(e){e.error="",e.warnings=[],e.info=""}},actions:{setErrorMessage:function(e,t){e.commit("clear"),e.commit("set",{error:t.message})},setWarningMessages:function(e,t){e.commit("clear"),e.commit("set",{warnings:t.messages})},setInfoMessage:function(e,t){e.commit("clear"),e.commit("set",{info:t.message})},clearMessages:function(e){e.commit("clear")}}},_={namespaced:!0,state:{uuid:"",salonname:""},mutations:{set:function(e,t){e.uuid=t.salon.uuid,e.salonname=t.salon.name},clear:function(e){e.uuid="",e.salonname=""}},actions:{getSalonData:function(e,t){return h.get("/salon/",{params:{staff:t.staff}}).then((function(t){if("object"===Object(d["a"])(t.data)){var s=t.data;e.commit("set",{salon:s})}})).catch((function(e){console.log(e)}))}}},w={namespaced:!0,state:{pointcards:[]},mutations:{set:function(e,t){e.pointcards=t.pointcards},clear:function(e){e.pointcards=[]}},actions:{getPointcards:function(e,t){return h.get("/pointcard/",{params:{salon:t.salon}}).then((function(t){var s=t.data;e.commit("set",{pointcards:s})}))}}},x=new f["a"].Store({modules:{auth:g,message:b,salon:_,pointcards:w}}),y=x,k=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"login-page"}},[s("GlobalHeader"),s("GlobalMessage"),s("main",{staticClass:"container mt-5 p-5"},[s("p",{staticClass:"h5 mb-5"},[e._v("Login")]),s("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[s("v-text-field",{attrs:{counter:10,rules:e.usernameRules,label:"Name",required:""},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),s("v-text-field",{attrs:{rules:e.passwordRules,label:"Password",type:"password",required:""},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),s("v-btn",{staticClass:"mt-4",attrs:{disabled:!e.valid,color:"primary",block:""},on:{click:e.validate}},[e._v(" Login ")])],1)],1)],1)},$=[],C=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"header"}},[s("v-app-bar",{attrs:{color:"primary",prominent:"",dark:""}},[s("v-app-bar-nav-icon",{attrs:{dark:""}}),s("v-toolbar-title",[e._v("Salon Admin")]),s("v-spacer"),s("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on;return[s("v-btn",e._g({attrs:{icon:""}},a),[s("v-icon",[e._v("mdi-account")])],1)]}}])},[s("v-list",[s("v-list-item",[s("v-list-item-title",[e._v(" "+e._s(e.username)+" ")])],1),s("v-list-item",[s("v-list-item-title",{on:{click:e.clickLogout}},[e._v(" ログアウト ")])],1)],1)],1)],1)],1)},P=[],j={computed:{username:function(){return this.$store.state.auth.username},isLoggedIn:function(){return this.$store.state.auth.isLoggedIn}},methods:{clickLogout:function(){this.$store.dispatch("auth/logout"),this.$store.dispatch("message/setInfoMessage",{message:"ログアウトしました。"}),this.$router.replace("/login")},clickLogin:function(){this.$store.dispatch("message/clearMessages"),this.$router.replace("/login")}}},M=j,O=Object(r["a"])(M,C,P,!1,null,null,null),I=O.exports,S=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"messages"}},[s("b-alert",{directives:[{name:"show",rawName:"v-show",value:e.message.error,expression:"message.error"}],staticClass:"mb-0",attrs:{variant:"danger",show:""}},[e._v(" "+e._s(e.message.error)+" ")]),s("b-alert",{directives:[{name:"show",rawName:"v-show",value:e.message.warnings.length>0,expression:"message.warnings.length > 0"}],staticClass:"mb-0",attrs:{variant:"warning",show:""}},e._l(e.message.warnings,(function(t){return s("p",{key:t,staticClass:"mb-0"},[e._v(" "+e._s(t)+" ")])})),0),s("b-alert",{directives:[{name:"show",rawName:"v-show",value:e.message.info,expression:"message.info"}],staticClass:"mb-0",attrs:{variant:"info",show:""}},[e._v(" "+e._s(e.message.info)+" ")])],1)},L=[],E={computed:{message:function(){return this.$store.state.message}}},D=E,q=Object(r["a"])(D,S,L,!1,null,null,null),Y=q.exports,R={components:{GlobalHeader:I,GlobalMessage:Y},data:function(){return{valid:!0,username:"",usernameRules:[function(e){return!!e||"ユーザー名を入力してください。"},function(e){return e&&e.length<=10||"ユーザー名は10文字以内です。"}],password:"",passwordRules:[function(e){return!!e||"パスワードを入力してください。"},function(e){return e&&e.length<=10||"パスワードは10文字以内です。"}]}},methods:{validate:function(){this.$refs.form.validate()&&this.submitLogin()},reset:function(){this.$refs.form.reset()},resetValidation:function(){this.$refs.form.resetValidation()},submitLogin:function(){var e=this;this.$store.dispatch("auth/login",{username:this.username,password:this.password}).then((function(){console.log("Login succeeded."),e.$store.dispatch("message/setInfoMessage",{message:"ログインしました。"});var t=e.$route.query.next||"/";e.$router.replace(t)}))}}},G=R,z=(s("b39d"),Object(r["a"])(G,k,$,!1,null,"66d13018",null)),H=z.exports,T=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"home"},[s("GlobalHeader"),s("GlobalMessage"),s("main",{staticClass:"container mt-5 p-5"},[s("Stamp"),s("Pointcards",{ref:"pointcards"}),s("CreatePointcard",{on:{created:e.fetchPointcards}}),s("Posts",{ref:"posts"}),s("Post",{on:{posted:e.fetchPosts}})],1)],1)},A=[],N=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"stamp"},[s("v-card",[s("v-card-title",[e._v("スタンプを発行する")]),s("v-form",{ref:"form",staticClass:"pa-3",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[s("v-select",{attrs:{items:e.pointcards,label:"ポイントカードを選択する","item-text":"uuid",attach:"","menu-props":{top:!1,offsetY:!0},"return-object":""},model:{value:e.selectedPointcard,callback:function(t){e.selectedPointcard=t},expression:"selectedPointcard"}}),s("v-select",{attrs:{items:e.customers,label:"利用者を選択する","item-text":"username",attach:"","menu-props":{top:!1,offsetY:!0},"return-object":""},model:{value:e.selectedCustomer,callback:function(t){e.selectedCustomer=t},expression:"selectedCustomer"}}),s("v-date-picker",{model:{value:e.picker,callback:function(t){e.picker=t},expression:"picker"}}),s("v-btn",{staticClass:"mt-4",attrs:{disabled:!e.valid,color:"primary",block:""},on:{click:e.validate}},[e._v(" スタンプを押す ")])],1)],1)],1)},W=[],J={name:"Stamp",data:function(){return{valid:!0,picker:new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString().substr(0,10),customers:[],selectedCustomer:{},selectedPointcard:{}}},computed:{pointcards:function(){return this.$store.state.pointcards.pointcards}},methods:{validate:function(){this.$refs.form.validate()&&this.submit()},reset:function(){this.$refs.form.reset()},submit:function(){var e=this;h.post("/stamp/",{customer:this.selectedCustomer.uuid,pointcard:this.selectedPointcard.uuid,stamped_at:this.picker}).then((function(t){console.log(t),e.reset()})).catch((function(e){console.log(e)}))},fetchCustomers:function(){var e=this;h.get("/customer/").then((function(t){e.customers=t.data})).catch((function(e){console.log(e)}))}},created:function(){this.fetchCustomers()}},U=J,F=(s("509b"),Object(r["a"])(U,N,W,!1,null,"541c7130",null)),V=F.exports,X=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"pointcards"},[s("v-card",{staticClass:"pb-1"},[s("v-card-title",[e._v("作成したポイントカード")]),e._l(e.pointcards,(function(t){return s("v-card",{key:t.uuid,staticClass:"ma-5 pa-3",attrs:{outlined:""}},[s("v-card-subtitle",{staticClass:"text-sm-left"},[e._v("Name: 〇〇 〇〇様")]),s("hr"),s("div",{staticClass:"frames"},[s("table",{staticClass:"table table-bordered"},e._l(t.vertical_cells_count,(function(a){return s("tr",{key:a,staticClass:"frame-line"},e._l(t.horizontal_cells_count,(function(e){return s("td",{key:e})})),0)})),0)]),s("hr"),s("v-card-text",{staticClass:"text-sm-caption text-sm-left"},[e._v("ご来店１回につき、１枠捺印致します。（お会計金額2,000円以上）")])],1)}))],2)],1)},B=[],K={name:"Pointcards",data:function(){return{}},computed:{pointcards:function(){return this.$store.state.pointcards.pointcards}},methods:{},created:function(){}},Q=K,Z=(s("da53"),Object(r["a"])(Q,X,B,!1,null,"16b7b42a",null)),ee=Z.exports,te=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"create-pointcard"},[s("v-card",[s("v-card-title",[e._v("ポイントカードを追加する")]),s("v-form",{ref:"form",staticClass:"pa-3",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[s("v-text-field",{attrs:{type:"number",label:"縦の枠数を入力してください。"},model:{value:e.v,callback:function(t){e.v=t},expression:"v"}}),s("v-text-field",{attrs:{type:"number",label:"横の枠数を入力してください。"},model:{value:e.h,callback:function(t){e.h=t},expression:"h"}}),s("v-btn",{staticClass:"mt-4",attrs:{disabled:!e.valid,color:"primary",block:""},on:{click:e.validate}},[e._v(" 作成する ")])],1)],1)],1)},se=[],ae={name:"CreatePointcard",data:function(){return{valid:!0,v:0,h:0}},methods:{validate:function(){this.$refs.form.validate()&&this.createPointcard()},reset:function(){this.$refs.form.reset()},createPointcard:function(){var e=this,t=this.$store.state.salon.uuid;h.post("/pointcard/",{salon:t,vertical_cells_count:this.v,horizontal_cells_count:this.h}).then((function(t){console.log(t),e.$emit("created"),e.reset()})).catch((function(e){console.log(e)}))}}},ne=ae,oe=(s("c8b0"),Object(r["a"])(ne,te,se,!1,null,"19bf863b",null)),re=oe.exports,ie=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"posts"},[s("v-card",[s("v-card-title",[e._v("お知らせ投稿一覧")]),s("v-data-table",{staticClass:"elevation-0",attrs:{headers:e.headers,items:e.formattedPosts},scopedSlots:e._u([{key:"item.edit",fn:function(t){var a=t.item;return[s("v-icon",{staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return e.editItem(a)}}},[e._v(" mdi-pencil ")])]}},{key:"item.delete",fn:function(t){var a=t.item;return[s("v-icon",{attrs:{small:""},on:{click:function(t){return e.deleteItem(a)}}},[e._v(" mdi-delete ")])]}}])})],1)],1)},ce=[];s("159b");function le(e,t){return e=new Date(e),t=t.replace(/YYYY/,e.getFullYear()),t=t.replace(/MM/,e.getMonth()+1),t=t.replace(/DD/,e.getDate()),t}var ue=le,de={name:"Posts",computed:{formattedPosts:function(){var e=[];return this.posts.forEach((function(t){e.push({id:t.id,title:t.title,published:ue(t.published,"YYYY年MM月DD日"),edit:"edit",delete:"delete"})})),e}},data:function(){return{headers:[{text:"投稿日時",align:"start",sortable:!1,value:"published"},{text:"投稿タイトル",value:"title"},{text:"編集",value:"edit"},{text:"削除",value:"delete"}],posts:[]}},methods:{fetchItems:function(){var e=this;this.posts=[],h.get("/news/").then((function(t){e.posts=t.data})).catch((function(e){console.log(e)}))},editItem:function(e){console.log(e)},deleteItem:function(e){var t=this;console.log(e),h.delete("/news/".concat(e.id,"/")).then((function(){t.fetchItems()})).catch((function(e){console.log(e)}))}},created:function(){this.fetchItems()}},fe=de,me=(s("a232"),Object(r["a"])(fe,ie,ce,!1,null,"34ebf05d",null)),pe=me.exports,ve=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"post"},[s("v-card",[s("v-card-title",[e._v("お知らせを投稿する")]),s("v-form",{ref:"form",staticClass:"pa-3",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[s("v-text-field",{attrs:{counter:10,rules:e.titleRules,label:"タイトル",required:""},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}),s("v-textarea",{attrs:{filled:"",required:""},model:{value:e.body,callback:function(t){e.body=t},expression:"body"}}),s("v-btn",{staticClass:"mt-4",attrs:{disabled:!e.valid,color:"primary",block:""},on:{click:e.validate}},[e._v(" 投稿する ")])],1)],1)],1)},he=[],ge={name:"Post",data:function(){return{valid:!0,title:"",titleRules:[function(e){return!!e||"タイトルを入力してください。"},function(e){return e&&e.length<=10||"タイトルは10文字以内です。"}],body:"",bodyRules:[function(e){return!!e||"本文を入力してください。"},function(e){return e&&e.length<=100||"本文は100文字以内です。"}]}},methods:{validate:function(){this.$refs.form.validate()&&this.submit()},reset:function(){this.$refs.form.reset()},submit:function(){var e=this;h.post("/news/",{title:this.title,body:this.body,published:new Date}).then((function(t){console.log("posted. ".concat(t.data)),e.$emit("posted"),e.reset()})).catch((function(e){console.log(e)}))}}},be=ge,_e=(s("41d4"),Object(r["a"])(be,ve,he,!1,null,"50b4436d",null)),we=_e.exports,xe={name:"Home",components:{GlobalHeader:I,GlobalMessage:Y,Stamp:V,Pointcards:ee,CreatePointcard:re,Posts:pe,Post:we},methods:{fetchPointcards:function(){console.log(this.$store.state.salon.uuid),this.$store.dispatch("pointcards/getPointcards",{salon:this.$store.state.salon.uuid}).then((function(){console.log("get salon data ad pointcards.")}))},fetchPosts:function(){this.$refs.posts.fetchItems()}},created:function(){var e=this;this.$store.dispatch("salon/getSalonData",{staff:this.$store.state.auth.useruuid}).then((function(){e.fetchPointcards()}))}},ye=xe,ke=Object(r["a"])(ye,T,A,!1,null,null,null),$e=ke.exports;a["default"].use(u["a"]);var Ce=[{path:"/login",name:"LoginPage",component:H},{path:"/",name:"Home",component:$e,meta:{requiresAuth:!0}},{path:"/:catchAll(.*)",redirect:"/"}],Pe=new u["a"]({mode:"history",base:"/owner/",routes:Ce});function je(e){console.log("Force to login page."),Pe.replace({path:"/login",query:{next:e.fullPath}})}Pe.beforeEach((function(e,t,s){var a=y.state.auth.isLoggedIn,n=localStorage.getItem("access");console.log("to.path=",e.path),console.log("isLoggedIn=",a),e.matched.some((function(e){return e.meta.requiresAuth}))?a?(console.log("User is already logged in. So, free to next."),s()):(console.log("User is not logged in."),null!=n?(console.log("Try to renew user info."),y.dispatch("auth/renew").then((function(){console.log("Succeeded to renew. So, free to next."),s()})).catch((function(){je(e)}))):je(e)):(console.log("Go to public page."),s())}));var Me=Pe,Oe=s("ce5b"),Ie=s.n(Oe),Se=(s("bf40"),s("dca6")),Le=s.n(Se);s("5363");a["default"].use(Ie.a);var Ee={lang:{locales:{ja:Le.a},current:"ja"},icons:{iconfont:"mdi"}},De=new Ie.a(Ee),qe=s("5f5b");s("f9e3"),s("2dd8");a["default"].use(qe["a"]),a["default"].config.productionTip=!1,new a["default"]({bootstrap:void 0,vuetify:De,router:Me,store:y,render:function(e){return e(l)}}).$mount("#app")},"603b":function(e,t,s){},"79cd":function(e,t,s){},"85ec":function(e,t,s){},a232:function(e,t,s){"use strict";s("603b")},b39d:function(e,t,s){"use strict";s("4dd4")},c8b0:function(e,t,s){"use strict";s("4af0")},da53:function(e,t,s){"use strict";s("2a67")},fefe:function(e,t,s){}});
//# sourceMappingURL=index.fb854ae0.js.map